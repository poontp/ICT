<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>互動數獨解說 (b)</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f4f4f4;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            box-sizing: border-box;
        }
        .container {
            background: #fff;
            padding: 25px;
            border-radius: 10px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            max-width: 650px;
            width: 100%;
        }
        h1, h2 {
            color: #0056b3;
            border-bottom: 2px solid #0056b3;
            padding-bottom: 10px;
            margin-top: 0;
        }
        .section {
            margin-bottom: 20px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background-color: #f9f9f9;
        }
        .hidden {
            display: none;
        }
        .sudoku-column {
            display: flex;
            flex-direction: column;
            width: 70px;
            margin: 15px auto;
            border: 3px solid #333;
        }
        .column-cell {
            width: 100%;
            height: 48px;
            border: 1px solid #ccc;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 22px;
            font-weight: bold;
            box-sizing: border-box;
            background-color: white;
            transition: background-color 0.3s, border 0.3s, color 0.3s;
        }
        .column-cell.empty {
            background-color: #e9ecef;
            color: #d9534f;
        }
        .column-cell.highlight {
            background-color: #fff3cd;
            border: 2px solid #ffc107;
        }
        .column-cell.solved {
            background-color: #d4edda;
            color: #155724;
            border: 2px solid #155724;
        }
        .number-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
            max-width: 200px;
            margin: 15px auto;
        }
        .number-btn {
            width: 50px;
            height: 50px;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            border: 1px solid #007bff;
            background-color: #fff;
            color: #007bff;
            border-radius: 5px;
            transition: background-color 0.3s, color 0.3s;
        }
        .number-btn:hover {
            background-color: #007bff;
            color: #fff;
        }
        .number-btn.used {
            background-color: #e0e0e0;
            color: #aaa;
            border-color: #ccc;
            cursor: not-allowed;
            text-decoration: line-through;
        }
        .result-text, .feedback {
            margin-top: 15px;
            font-weight: bold;
            min-height: 24px;
            text-align: center;
            padding: 10px;
            border-radius: 5px;
        }
        .correct {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .incorrect {
            background-color: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .proceed-btn, .action-btn, .check-btn {
            display: block;
            margin: 15px auto 0;
            padding: 10px 20px;
            font-size: 16px;
            cursor: pointer;
            background-color: #28a745;
            color: white;
            border: none;
            border-radius: 5px;
        }
        .proceed-btn:disabled, .action-btn:disabled, .check-btn:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        #algo-display-container {
            display: flex;
            justify-content: space-around;
            align-items: center;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }
        .calculator {
            background: #2c3e50;
            color: #ecf0f1;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', Courier, monospace;
            text-align: center;
            flex-grow: 1;
            min-width: 250px;
        }
        .calc-display {
            font-size: 36px;
            font-weight: bold;
            margin-bottom: 10px;
            min-height: 45px;
            transition: color 0.5s;
        }
        .calc-operation {
            font-size: 18px;
            min-height: 48px;
        }
        .code-box {
            background-color: #eef;
            border-left: 4px solid #667eea;
            padding: 15px;
            margin-top: 15px;
            font-family: 'Courier New', Courier, monospace;
            white-space: pre;
            font-size: 16px;
        }
        .code-input {
            width: 40px;
            text-align: center;
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            border: 1px solid #aaa;
            border-radius: 3px;
        }
        .code-select {
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            border: 1px solid #aaa;
            border-radius: 3px;
            padding: 2px;
        }
        .sub-step { margin-bottom: 15px; }

        .column-visual-for-algo {
            display: flex;
            flex-direction: column;
            align-items: center;
            margin: 20px 0;
            gap: 5px;
        }
        .column-item {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .column-index {
            font-family: 'Courier New', Courier, monospace;
            font-size: 16px;
            color: #555;
            width: 80px;
            text-align: right;
        }
        .column-cell-small {
            width: 45px;
            height: 45px;
            border: 1px solid #999;
            display: flex;
            justify-content: center;
            align-items: center;
            font-size: 20px;
            font-weight: bold;
            background-color: white;
        }
        .column-cell-small.target-cell {
            background-color: #fffbe0;
            color: #d9534f;
            border: 2px solid #d9534f;
        }
    </style>
</head>
<body>

<div class="container">
    <h1>互動數獨解說 (b)</h1>
    <p><strong>規則：</strong>在 9x9 的方格內，每一直欄都必須包含數字 1 至 9，不能重複，也不能缺少。</p>

    <!-- Step 1: Direct Find -->
    <div class="section" id="direct-find-section">
        <h2>第一步：直觀找出遺失數字</h2>
        <p>題目中的第二欄 (j=1) 已經有 8 個數字。請觀察下方的直欄和數字表，找出唯一遺失的數字來填入 S[8,1] 中。</p>
        <div style="display: flex; justify-content: space-around; align-items: center; flex-wrap: wrap; gap: 20px;">
            <div class="sudoku-column" id="visual-column"></div>
            <div class="number-grid" id="number-choice-grid"></div>
        </div>
        <div id="direct-find-result" class="result-text hidden"></div>
        <button id="to-step2-btn" class="proceed-btn hidden" onclick="showSection('algo-explain-section')">下一步：理解演算法</button>
    </div>

    <!-- Step 2: Algorithm Explanation -->
    <div class="section hidden" id="algo-explain-section">
        <h2>第二步：理解演算法</h2>
        <p>這個方法是將 1 到 9 的總和 (45) 算出來，然後逐一減去所有已知的數字。請點擊按鈕，觀察右邊的計算過程以及左邊欄位對應的變化。</p>
        <div id="algo-display-container">
            <div class="sudoku-column" id="algo-visual-column"></div>
            <div class="calculator">
                <div class="calc-operation" id="calc-op-display">&nbsp;</div>
                <div class="calc-display" id="calc-total-display">45</div>
            </div>
        </div>
        <button class="action-btn" id="algo-step-btn" onclick="runAlgorithmStep()">開始計算</button>
        <div id="algo-result" class="result-text hidden"></div>
        <button id="to-step3-btn" class="proceed-btn hidden" onclick="showSection('algo-fill-section')">下一步：完成演算法</button>
    </div>

    <!-- Step 3: Algorithm Fill-in -->
    <div class="section hidden" id="algo-fill-section">
        <h2>第三步：互動演算法填空</h2>
        <p>現在，讓我們親手完成這個演算法。為了幫助你思考，這裡完整列出第二欄 (j=1) 的內容以及它們對應的索引 (i)：</p>
        <div id="column-visual-for-algo" class="column-visual-for-algo"></div>
        <div class="code-box">S[8,1] ← 45
設 i 由 <span id="loop-start-final">__</span> 至 <span id="loop-end-final">__</span>
    S[8,1] ← <span id="operation-final">____________</span></div>
        <div class="sub-step" id="sub-step1">
            <p style="margin-top: 20px;"><strong>3.1: 迴圈從哪裡開始？</strong> 根據上圖，遍歷已知數字的迴圈，其索引 i 應該從哪個數字開始？</p>
            <label for="loop-start-input">設 i 由</label>
            <input id="loop-start-input" class="code-input" type="number">
            <button class="check-btn" onclick="checkSubStep1()">檢查</button>
            <div id="feedback1" class="feedback hidden"></div>
        </div>
        <div class="sub-step hidden" id="sub-step2">
            <p><strong>3.2: 迴圈在哪裡結束？</strong> 同樣根據上圖，迴圈的索引 i 應該在哪個數字結束？</p>
            <label for="loop-end-input">至</label>
            <input id="loop-end-input" class="code-input" type="number">
            <button class="check-btn" onclick="checkSubStep2()">檢查</button>
            <div id="feedback2" class="feedback hidden"></div>
        </div>
        <div class="sub-step hidden" id="sub-step3">
            <p><strong>3.3: 迴圈內做什麼？</strong> 在每次迴圈中，我們應該如何更新 S[8,1] 的值（初始值為 45）？</p>
            <label for="operation-select">S[8,1] ←</label>
            <select id="operation-select" class="code-select">
                <option value="">--請選擇操作--</option>
                <option value="add">S[8,1] + S[i,1]</option>
                <option value="subtract">S[8,1] - S[i,1]</option>
                <option value="from45">45 - S[i,1]</option>
            </select>
            <button class="check-btn" onclick="checkSubStep3()">檢查</button>
            <div id="feedback3" class="feedback hidden"></div>
        </div>
        <div id="final-result" class="result-text hidden" style="margin-top: 20px;">
            <h3>恭喜！你已完成所有步驟！</h3>
            <p>你已經透過直觀和演算法兩種方式，成功找到了答案，並完成了演算法的建構。最終答案為 <strong>6</strong>。</p>
        </div>
    </div>
</div>

<script>
    const knownNumbers = [9, 2, 8, 3, 7, 4, 5, 1];
    const correctAnswer = 6;
    let currentAlgorithmStep = -1;
    let currentSum = 45;

    function showSection(sectionId) {
        document.getElementById(sectionId).classList.remove('hidden');
        document.getElementById(sectionId).scrollIntoView({ behavior: 'smooth', block: 'start' });
    }

    function showFeedback(id, message, isCorrect) {
        const el = document.getElementById(id);
        el.innerHTML = message;
        el.className = 'feedback';
        el.classList.add(isCorrect ? 'correct' : 'incorrect');
    }

    function setupDirectFind() {
        const colContainer = document.getElementById('visual-column');
        colContainer.innerHTML = '';
        knownNumbers.forEach(num => {
            colContainer.innerHTML += `<div class="column-cell">${num}</div>`;
        });
        colContainer.innerHTML += `<div class="column-cell empty" id="empty-visual-cell">?</div>`;

        const gridContainer = document.getElementById('number-choice-grid');
        gridContainer.innerHTML = '';
        for (let i = 1; i <= 9; i++) {
            const btn = document.createElement('button');
            btn.className = 'number-btn';
            btn.textContent = i;
            if (knownNumbers.includes(i)) {
                btn.classList.add('used');
                btn.disabled = true;
            } else {
                btn.onclick = () => checkDirectFind(i);
            }
            gridContainer.appendChild(btn);
        }
    }

    function checkDirectFind(num) {
        const resultText = document.getElementById('direct-find-result');
        const emptyCell = document.getElementById('empty-visual-cell');
        if (num === correctAnswer) {
            resultText.textContent = `答對了！直欄中缺少的數字就是 ${correctAnswer}。`;
            resultText.className = 'result-text correct';
            emptyCell.textContent = num;
            emptyCell.classList.remove('empty');
            document.getElementById('to-step2-btn').classList.remove('hidden');
            const buttons = document.getElementById('number-choice-grid').getElementsByTagName('button');
            for(let button of buttons) {
                if (!button.classList.contains('used')) { button.disabled = true; }
            }
        }
    }

    function setupAlgoVisualColumn() {
        const colContainer = document.getElementById('algo-visual-column');
        colContainer.innerHTML = '';
        knownNumbers.forEach((num, index) => {
            colContainer.innerHTML += `<div class="column-cell" id="algo-cell-${index}">${num}</div>`;
        });
        colContainer.innerHTML += `<div class="column-cell empty" id="algo-empty-cell">?</div>`;
    }

    function runAlgorithmStep() {
        const opDisplay = document.getElementById('calc-op-display');
        const totalDisplay = document.getElementById('calc-total-display');
        const resultText = document.getElementById('algo-result');
        const stepBtn = document.getElementById('algo-step-btn');
        
        if (currentAlgorithmStep === -1) {
            stepBtn.textContent = '下一步';
        } else {
            const prevCell = document.getElementById(`algo-cell-${currentAlgorithmStep}`);
            if (prevCell) prevCell.classList.remove('highlight');
        }

        currentAlgorithmStep++;
        
        if (currentAlgorithmStep < knownNumbers.length) {
            const numToSubtract = knownNumbers[currentAlgorithmStep];
            const newSum = currentSum - numToSubtract;
            
            const currentCell = document.getElementById(`algo-cell-${currentAlgorithmStep}`);
            if (currentCell) currentCell.classList.add('highlight');
            
            opDisplay.innerHTML = `減去 <strong>S[${currentAlgorithmStep}, 1]</strong> 的值 (${numToSubtract})<br>${currentSum} - ${numToSubtract} = ${newSum}`;
            totalDisplay.textContent = newSum;
            currentSum = newSum;
            totalDisplay.style.color = '#f1c40f';
            setTimeout(() => { totalDisplay.style.color = '#ecf0f1'; }, 500);
        }
        
        if (currentAlgorithmStep >= knownNumbers.length) {
             stepBtn.disabled = true;
             stepBtn.textContent = '計算完成';
             opDisplay.innerHTML = '所有已知數字都已減去。';
             resultText.innerHTML = `計算完成！最後剩下的數字是 ${currentSum}，這就是 S[8,1] 的答案。`;
             resultText.className = 'result-text correct';
             document.getElementById('to-step3-btn').classList.remove('hidden');

             const finalCell = document.getElementById('algo-empty-cell');
             if (finalCell) {
                 finalCell.textContent = currentSum;
                 finalCell.classList.remove('empty');
                 finalCell.classList.add('solved');
             }
        }
    }

    function createColumnVisualForStep3() {
        const container = document.getElementById('column-visual-for-algo');
        container.innerHTML = '';
        knownNumbers.forEach((num, index) => {
            container.innerHTML += `<div class="column-item"><div class="column-index">S[${index}, 1]</div><div class="column-cell-small">${num}</div></div>`;
        });
        container.innerHTML += `<div class="column-item"><div class="column-index">S[8, 1]</div><div class="column-cell-small target-cell">?</div></div>`;
    }

    function checkSubStep1() {
        const input = document.getElementById('loop-start-input');
        const userAnswer = parseInt(input.value, 10);
        if (userAnswer === 0) {
            showFeedback('feedback1', '完全正確！在電腦科學中，陣列或列表的索引通常從 0 開始。', true);
            input.disabled = true;
            document.querySelector('#sub-step1 .check-btn').disabled = true;
            document.getElementById('loop-start-final').textContent = 0;
            document.getElementById('sub-step2').classList.remove('hidden');
            document.getElementById('loop-end-input').focus();
        } else {
            showFeedback('feedback1', '不對喔。提示：請看視覺化欄位中第一個數字 S[i, 1] 的 i 是多少。', false);
        }
    }

    function checkSubStep2() {
        const input = document.getElementById('loop-end-input');
        const userAnswer = parseInt(input.value, 10);
        if (userAnswer === 7) {
            showFeedback('feedback2', '答對了！因為總共有 8 個已知的數字，所以索引是從 0 到 7。', true);
            input.disabled = true;
            document.querySelector('#sub-step2 .check-btn').disabled = true;
            document.getElementById('loop-end-final').textContent = 7;
            document.getElementById('sub-step3').classList.remove('hidden');
            document.getElementById('operation-select').focus();
        } else {
            showFeedback('feedback2', '不對喔。提示：請看視覺化欄位中最後一個「已知」數字 S[i, 1] 的 i 是多少。', false);
        }
    }

    function checkSubStep3() {
        const select = document.getElementById('operation-select');
        const userAnswer = select.value;
        if (userAnswer === 'subtract') {
            showFeedback('feedback3', '非常棒！我們的目標是從總和中「移除」已知的數字，所以使用減法是完全正確的。', true);
            select.disabled = true;
            document.querySelector('#sub-step3 .check-btn').disabled = true;
            document.getElementById('operation-final').textContent = 'S[8,1] - S[i,1]';
            document.getElementById('final-result').classList.remove('hidden');
        } else {
            showFeedback('feedback3', '不對喔。我們的目標是從總和 45 中，逐一「減去」已知的數字。', false);
        }
    }

    window.onload = function() {
        setupDirectFind();
        setupAlgoVisualColumn();
        createColumnVisualForStep3();
    };
</script>

</body>
</html>