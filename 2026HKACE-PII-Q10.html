<!DOCTYPE html>
<html lang="zh-HK">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>冒泡排序法互動教學 (Bubble Sort Visualizer)</title>
    
    <!-- 載入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 載入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 載入 Babel 用於解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <style>
        body {
            background-color: #f3f4f6;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        /* 自定義滾動條樣式 */
        .code-scroll::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        .code-scroll::-webkit-scrollbar-track {
            background: #1f2937; 
        }
        .code-scroll::-webkit-scrollbar-thumb {
            background: #4b5563; 
            border-radius: 4px;
        }
        .code-scroll::-webkit-scrollbar-thumb:hover {
            background: #6b7280; 
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // SVG 圖標組件
        const Icons = {
            Play: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>,
            Pause: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>,
            SkipBack: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="19 20 9 12 19 4 19 20"></polygon><line x1="5" y1="19" x2="5" y2="5"></line></svg>,
            SkipForward: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 4 15 12 5 20 5 4"></polygon><line x1="19" y1="5" x2="19" y2="19"></line></svg>,
            RotateCcw: () => <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"></path><path d="M3 3v9h9"></path></svg>,
            CheckCircle: () => <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
        };

        const BubbleSortVisualizer = () => {
            const initialArray = [13, 7, 44, 16, 9];
            const N = 5;

            const [currentStep, setCurrentStep] = useState(0);
            const [isPlaying, setIsPlaying] = useState(false);
            const [activeTab, setActiveTab] = useState('simulation'); 

            // 預先計算所有步驟
            const steps = useMemo(() => {
                const stepsData = [];
                let arr = [...initialArray];
                let swapCount = 0;
                
                stepsData.push({
                    arr: [...arr],
                    i: -1, j: -1, comparing: [], swapping: false, swapCount: 0,
                    description: "初始狀態：準備開始排序",
                    line: 0
                });

                for (let i = 0; i <= N - 2; i++) {
                    stepsData.push({
                        arr: [...arr], i, j: -1, comparing: [], swapping: false, swapCount,
                        description: `外層迴圈 i = ${i} 開始`,
                        line: 1
                    });

                    for (let j = 0; j <= N - 2; j++) {
                        stepsData.push({
                            arr: [...arr], i, j, comparing: [j, j + 1], swapping: false, swapCount,
                            description: `比較 A[${j}] (${arr[j]}) 和 A[${j+1}] (${arr[j+1]})`,
                            line: 3
                        });

                        if (arr[j] > arr[j + 1]) {
                            let temp = arr[j];
                            arr[j] = arr[j + 1];
                            arr[j + 1] = temp;
                            swapCount++;

                            stepsData.push({
                                arr: [...arr], i, j, comparing: [j, j + 1], swapping: true, swapCount,
                                description: `交換！因為 ${arr[j+1]} > ${arr[j]} (原值)，執行第 6 行`,
                                line: 6
                            });
                        } else {
                            stepsData.push({
                                arr: [...arr], i, j, comparing: [j, j + 1], swapping: false, swapCount,
                                description: `不交換，因為 ${arr[j]} 不大於 ${arr[j+1]}`,
                                line: 3
                            });
                        }
                    }
                }
                
                stepsData.push({
                    arr: [...arr], i: N-2, j: N-2, comparing: [], swapping: false, swapCount,
                    description: "排序完成",
                    line: 7
                });

                return stepsData;
            }, []);

            useEffect(() => {
                let interval;
                if (isPlaying && currentStep < steps.length - 1) {
                    interval = setInterval(() => {
                        setCurrentStep((prev) => prev + 1);
                    }, 800);
                } else {
                    setIsPlaying(false);
                }
                return () => clearInterval(interval);
            }, [isPlaying, currentStep, steps.length]);

            const currentData = steps[currentStep];

            const jumpToSwap = (targetSwapCount) => {
                const stepIndex = steps.findIndex(s => s.swapCount === targetSwapCount && s.swapping === true);
                if (stepIndex !== -1) {
                    setCurrentStep(stepIndex);
                    setActiveTab('simulation');
                }
            };

            // 輔助組件：程式碼行
            // 使用 Flexbox 讓行號固定在左側，文字另外縮排
            const CodeLine = ({ num, text, indentClass, isActive }) => (
                <div className={`flex items-start py-1 rounded transition-colors duration-200 ${isActive ? 'bg-yellow-600 text-white font-bold' : ''}`}>
                    {/* 行號區域：固定寬度，靠左對齊 */}
                    <span className="w-8 flex-none text-left pl-2 opacity-50 select-none font-mono">
                        {num}
                    </span>
                    {/* 程式碼文字區域：包含縮排 */}
                    <span className={`flex-1 font-mono ${indentClass}`}>
                        {text}
                    </span>
                </div>
            );

            return (
                <div className="max-w-6xl mx-auto p-4 md:p-6">
                    <div className="bg-white rounded-xl shadow-lg overflow-hidden min-h-[600px] flex flex-col">
                        <div className="bg-blue-800 p-4 md:p-6 text-white flex justify-between items-center flex-wrap gap-4">
                            <div>
                                <h1 className="text-xl md:text-3xl font-bold">冒泡排序法 (Bubble Sort)</h1>
                                <p className="opacity-80 text-sm mt-1">HKACE-ICT MOCK EXAM 2026-2 Q10</p>
                            </div>
                            {/* 導航 Tabs */}
                            <div className="flex bg-blue-900/50 rounded-lg p-1">
                                <button
                                    onClick={() => setActiveTab('simulation')}
                                    className={`px-4 py-2 rounded-md text-sm font-medium transition-all ${
                                        activeTab === 'simulation' ? 'bg-white text-blue-900 shadow' : 'text-blue-100 hover:bg-blue-800'
                                    }`}
                                >
                                    模擬演示
                                </button>
                                <button
                                    onClick={() => setActiveTab('answers')}
                                    className={`px-4 py-2 rounded-md text-sm font-medium transition-all ${
                                        activeTab === 'answers' ? 'bg-white text-blue-900 shadow' : 'text-blue-100 hover:bg-blue-800'
                                    }`}
                                >
                                    題目詳解
                                </button>
                            </div>
                        </div>

                        <div className="flex-1 p-4 md:p-6 bg-gray-50">
                            {activeTab === 'simulation' && (
                                <div className="flex flex-col lg:flex-row gap-6 h-full">
                                    
                                    {/* 左側：偽代碼區域 */}
                                    <div className="lg:w-1/3 flex flex-col">
                                        <div className="bg-gray-800 text-gray-300 rounded-lg shadow-lg overflow-hidden flex flex-col h-full border border-gray-700">
                                            <div className="bg-gray-900 px-4 py-2 text-xs font-bold text-gray-400 uppercase tracking-wider border-b border-gray-700">
                                                Pseudocode (偽代碼)
                                            </div>
                                            <div className="p-2 font-mono text-sm md:text-base leading-loose overflow-y-auto code-scroll flex-1">
                                                
                                                <CodeLine 
                                                    num="1" 
                                                    text="設 i 由 0 至 N - 2 執行" 
                                                    indentClass="" 
                                                    isActive={currentData.line === 1} 
                                                />
                                                <CodeLine 
                                                    num="2" 
                                                    text="設 j 由 0 至 N - 2 執行" 
                                                    indentClass="pl-4" 
                                                    isActive={currentData.line === 2} 
                                                />
                                                <CodeLine 
                                                    num="3" 
                                                    text="如果 A[j] > A[j + 1] 則" 
                                                    indentClass="pl-8" 
                                                    isActive={currentData.line === 3} 
                                                />
                                                <CodeLine 
                                                    num="4" 
                                                    text="temp ← A[j]" 
                                                    indentClass="pl-12" 
                                                    isActive={currentData.line === 4} 
                                                />
                                                <CodeLine 
                                                    num="5" 
                                                    text="A[j] ← A[j + 1]" 
                                                    indentClass="pl-12" 
                                                    isActive={currentData.line === 5} 
                                                />
                                                <CodeLine 
                                                    num="6" 
                                                    text="A[j + 1] ← temp" 
                                                    indentClass="pl-12" 
                                                    isActive={currentData.line === 6} 
                                                />

                                            </div>
                                            
                                            {/* 變數監控小面板 */}
                                            <div className="bg-gray-900 p-4 border-t border-gray-700 grid grid-cols-3 gap-2 text-center text-sm">
                                                <div>
                                                    <div className="text-gray-500 text-xs">i</div>
                                                    <div className="font-mono text-yellow-400 font-bold text-lg">{currentData.i === -1 ? '-' : currentData.i}</div>
                                                </div>
                                                <div>
                                                    <div className="text-gray-500 text-xs">j</div>
                                                    <div className="font-mono text-yellow-400 font-bold text-lg">{currentData.j === -1 ? '-' : currentData.j}</div>
                                                </div>
                                                <div>
                                                    <div className="text-gray-500 text-xs">Swap Count</div>
                                                    <div className="font-mono text-green-400 font-bold text-lg">{currentData.swapCount}</div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>

                                    {/* 右側：視覺化區域 */}
                                    <div className="lg:w-2/3 flex flex-col gap-4">
                                        <div className="bg-white p-6 rounded-lg shadow border border-gray-200 flex-1 flex flex-col justify-center items-center relative min-h-[400px]">
                                            
                                            {/* 描述文字 */}
                                            <div className="absolute top-4 left-0 right-0 text-center px-4">
                                                <span className="inline-block bg-blue-50 text-blue-800 px-4 py-2 rounded-full font-medium border border-blue-100 shadow-sm text-sm md:text-base">
                                                    {currentData.description}
                                                </span>
                                            </div>

                                            {/* 陣列視覺化 */}
                                            <div className="flex gap-3 md:gap-6 items-end justify-center h-40 w-full mt-8">
                                                {currentData.arr.map((val, idx) => {
                                                    const isComparing = currentData.comparing.includes(idx);
                                                    const isSwapping = currentData.swapping && isComparing;
                                                    
                                                    return (
                                                        <div key={idx} className="flex flex-col items-center gap-2 relative group">
                                                            {/* 數值條/方塊 */}
                                                            <div
                                                                className={`w-12 h-12 md:w-16 md:h-16 flex items-center justify-center rounded-lg text-xl md:text-2xl font-bold border-2 shadow-sm transition-all duration-300
                                                                    ${isSwapping ? 'bg-red-100 border-red-500 text-red-700 scale-110 z-10 shadow-lg' : 
                                                                    isComparing ? 'bg-yellow-100 border-yellow-500 text-yellow-700 scale-105 z-10' : 
                                                                    'bg-gray-50 border-gray-300 text-gray-700'}
                                                                `}
                                                            >
                                                                {val}
                                                            </div>
                                                            {/* 索引標籤 */}
                                                            <span className="text-xs text-gray-400 font-mono bg-gray-100 px-1 rounded">[{idx}]</span>
                                                            
                                                            {/* j 指標 */}
                                                            {currentData.j === idx && (
                                                                <div className="absolute -bottom-10 flex flex-col items-center text-blue-600 animate-bounce transition-all">
                                                                    <span className="text-lg font-bold">↑</span>
                                                                    <span className="text-xs font-bold bg-blue-100 px-1 rounded">j</span>
                                                                </div>
                                                            )}
                                                            {/* j+1 指標 */}
                                                            {currentData.j + 1 === idx && currentData.j !== -1 && (
                                                                <div className="absolute -bottom-10 flex flex-col items-center text-blue-600 animate-bounce transition-all delay-75">
                                                                    <span className="text-lg font-bold">↑</span>
                                                                    <span className="text-xs font-bold bg-blue-100 px-1 rounded">j+1</span>
                                                                </div>
                                                            )}
                                                        </div>
                                                    );
                                                })}
                                            </div>
                                        </div>

                                        {/* 控制面板 */}
                                        <div className="bg-white p-4 rounded-lg shadow border border-gray-200">
                                            <div className="flex flex-col md:flex-row justify-between items-center gap-4">
                                                <div className="flex gap-2">
                                                    <button onClick={() => setCurrentStep(0)} disabled={isPlaying} className="p-2 text-gray-600 hover:bg-gray-100 rounded disabled:opacity-50 transition-colors" title="重置">
                                                        <Icons.RotateCcw />
                                                    </button>
                                                    <button onClick={() => setCurrentStep(Math.max(0, currentStep - 1))} disabled={isPlaying} className="p-2 text-gray-600 hover:bg-gray-100 rounded disabled:opacity-50 transition-colors" title="上一步">
                                                        <Icons.SkipBack />
                                                    </button>
                                                    <button onClick={() => setIsPlaying(!isPlaying)} className={`p-2 px-6 rounded-full text-white shadow-md transition-all flex items-center justify-center gap-2 ${isPlaying ? 'bg-amber-500 hover:bg-amber-600' : 'bg-blue-600 hover:bg-blue-700'}`} title={isPlaying ? "暫停" : "播放"}>
                                                        {isPlaying ? <><Icons.Pause /><span className="text-sm font-bold">暫停</span></> : <><Icons.Play /><span className="text-sm font-bold">播放</span></>}
                                                    </button>
                                                    <button onClick={() => setCurrentStep(Math.min(steps.length - 1, currentStep + 1))} disabled={isPlaying} className="p-2 text-gray-600 hover:bg-gray-100 rounded disabled:opacity-50 transition-colors" title="下一步">
                                                        <Icons.SkipForward />
                                                    </button>
                                                </div>
                                                
                                                <div className="flex gap-2 text-sm">
                                                    <button onClick={() => jumpToSwap(1)} className="px-3 py-1.5 bg-purple-50 text-purple-700 rounded hover:bg-purple-100 border border-purple-200 transition-colors text-xs font-medium">
                                                        跳至 Swap #1 (a)
                                                    </button>
                                                    <button onClick={() => jumpToSwap(4)} className="px-3 py-1.5 bg-purple-50 text-purple-700 rounded hover:bg-purple-100 border border-purple-200 transition-colors text-xs font-medium">
                                                        跳至 Swap #4 (b)
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            {/* 進度條 */}
                                            <div className="mt-4 w-full bg-gray-200 rounded-full h-1.5">
                                                <div 
                                                    className="bg-blue-600 h-1.5 rounded-full transition-all duration-300" 
                                                    style={{ width: `${(currentStep / (steps.length - 1)) * 100}%` }}
                                                ></div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'answers' && (
                                <div className="max-w-3xl mx-auto space-y-6 animate-fade-in bg-white p-8 rounded-lg shadow-sm border border-gray-200">
                                    {/* Question A */}
                                    <div className="border-b border-gray-100 pb-6">
                                        <div className="flex items-center gap-2 mb-3">
                                            <span className="bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded">題目 (a)</span>
                                            <h3 className="text-lg font-bold text-gray-800">在第一次執行第 6 行後，j 和 A[j] 的值是多少？</h3>
                                        </div>
                                        <div className="bg-green-50 p-4 rounded-lg border border-green-200 mb-3">
                                            <p className="text-green-800 font-bold text-lg flex items-center gap-2">
                                                <Icons.CheckCircle /> 答案：j = 0, A[j] = 7
                                            </p>
                                        </div>
                                        <div className="text-gray-600 text-sm leading-relaxed pl-4 border-l-4 border-gray-300">
                                            <p className="mb-2"><strong>解析：</strong></p>
                                            <ul className="list-disc pl-5 space-y-1">
                                                <li>初始陣列為 [13, 7, 44, 16, 9]。</li>
                                                <li>當 i=0, j=0 時，比較 A[0] (13) 和 A[1] (7)。</li>
                                                <li>因為 13 &gt; 7，條件成立，執行交換（第 6 行）。</li>
                                                <li>交換後陣列變為 [7, 13, 44, 16, 9]。</li>
                                                <li>此時 j 依然是 0，而新的 A[0] 變成了 7。</li>
                                            </ul>
                                        </div>
                                    </div>

                                    {/* Question B */}
                                    <div className="border-b border-gray-100 pb-6">
                                        <div className="flex items-center gap-2 mb-3">
                                            <span className="bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded">題目 (b)</span>
                                            <h3 className="text-lg font-bold text-gray-800">在第四次執行第 6 行後，j 和 A[j] 的值是多少？</h3>
                                        </div>
                                        <div className="bg-green-50 p-4 rounded-lg border border-green-200 mb-3">
                                            <p className="text-green-800 font-bold text-lg flex items-center gap-2">
                                                <Icons.CheckCircle /> 答案：j = 2, A[j] = 9
                                            </p>
                                        </div>
                                        <div className="text-gray-600 text-sm leading-relaxed pl-4 border-l-4 border-gray-300">
                                            <p className="mb-2"><strong>解析交換過程：</strong></p>
                                            <ol className="list-decimal pl-5 space-y-1 font-mono text-xs md:text-sm">
                                                <li>(i=0, j=0) 13與7交換 → [7, 13, 44, 16, 9]</li>
                                                <li>(i=0, j=2) 44與16交換 → [7, 13, 16, 44, 9]</li>
                                                <li>(i=0, j=3) 44與9交換 → [7, 13, 16, 9, 44]</li>
                                                <li className="font-bold text-blue-600">(i=1, j=2) 16與9交換 → [7, 13, 9, 16, 44] (第四次)</li>
                                            </ol>
                                            <p className="mt-2">第四次交換發生在 i=1, j=2 時。交換完成後，A[2] 的值變成了 9。</p>
                                        </div>
                                    </div>

                                    {/* Question C */}
                                    <div className="border-b border-gray-100 pb-6">
                                        <div className="flex items-center gap-2 mb-3">
                                            <span className="bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded">題目 (c)</span>
                                            <h3 className="text-lg font-bold text-gray-800">寫出此排序算法的名稱。</h3>
                                        </div>
                                        <div className="bg-green-50 p-4 rounded-lg border border-green-200">
                                            <p className="text-green-800 font-bold text-lg flex items-center gap-2">
                                                <Icons.CheckCircle /> 答案：冒泡排序法 (Bubble Sort)
                                            </p>
                                        </div>
                                    </div>

                                    {/* Question D */}
                                    <div className="border-b border-gray-100 pb-6">
                                        <div className="flex items-center gap-2 mb-3">
                                            <span className="bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded">題目 (d)</span>
                                            <h3 className="text-lg font-bold text-gray-800">修改第 2 行以減少排序所需的迭代次數。</h3>
                                        </div>
                                        <div className="bg-green-50 p-4 rounded-lg border border-green-200 mb-3">
                                            <p className="text-green-800 font-bold text-lg flex items-center gap-2">
                                                <Icons.CheckCircle /> 答案：設 j 由 0 至 N - 2 - i 執行
                                            </p>
                                        </div>
                                        <div className="text-gray-600 text-sm leading-relaxed pl-4 border-l-4 border-gray-300">
                                            <p><strong>解析：</strong></p>
                                            <p>冒泡排序法的特性是，每一輪外層迴圈（i）結束後，最大的元素會「浮」到陣列的最後面。因此，第 i 輪結束後，最後 i 個元素已經排序好了，內層迴圈不需要再檢查它們。</p>
                                        </div>
                                    </div>

                                    {/* Question E */}
                                    <div>
                                        <div className="flex items-center gap-2 mb-3">
                                            <span className="bg-blue-100 text-blue-800 text-xs font-bold px-2 py-1 rounded">題目 (e)</span>
                                            <h3 className="text-lg font-bold text-gray-800">簡要描述將陣列排序為降冪所需的變更。</h3>
                                        </div>
                                        <div className="bg-green-50 p-4 rounded-lg border border-green-200 mb-3">
                                            <p className="text-green-800 font-bold text-lg flex items-center gap-2">
                                                <Icons.CheckCircle /> 答案：將第 3 行的比較符號由 &gt; 改為 &lt;
                                            </p>
                                        </div>
                                        <div className="text-gray-600 text-sm leading-relaxed pl-4 border-l-4 border-gray-300">
                                            <p><strong>解析：</strong></p>
                                            <p>目前的條件是 <code>A[j] &gt; A[j+1]</code> 時交換，這會把大的數字往後推（升冪）。若改為 <code>A[j] &lt; A[j+1]</code>，則當前面的數字比後面小的時候交換，這會把小的數字往後推，大的數字留在前面（降冪）。</p>
                                        </div>
                                    </div>
                                </div>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<BubbleSortVisualizer />);
    </script>
</body>
</html>