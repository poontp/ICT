<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ICT 考試題目模擬 (指令路徑與偽代碼)</title>
    
    <!-- 引入 React 和 ReactDOM -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    
    <!-- 引入 Babel 用於解析 JSX -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- 引入 Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body {
            background-color: #f3f4f6;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        /* 自定義滾動條樣式 */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1; 
        }
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1; 
            border-radius: 4px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8; 
        }
    </style>
</head>
<body>

    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // --- Icon Components (SVG) ---
        const PlayIcon = ({ size = 24, fill = "none" }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill={fill} stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polygon points="5 3 19 12 5 21 5 3"></polygon></svg>
        );
        const RotateCcwIcon = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 12"></path><path d="M3 5v7h7"></path></svg>
        );
        const CheckCircleIcon = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path><polyline points="22 4 12 14.01 9 11.01"></polyline></svg>
        );
        const ChevronRightIcon = ({ size = 24 }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round"><polyline points="9 18 15 12 9 6"></polyline></svg>
        );

        // --- Part A Component: Path Simulation ---
        const PartASimulation = () => {
            const [step, setStep] = useState(0);
            // Path stores history: [{x, y}, {x, y}...]
            const [path, setPath] = useState([{ x: 0, y: 0 }]);
            
            // X is Vertical (Row), Y is Horizontal (Col)
            const instructions = [
                { id: 0, code: 'Start', param: '-', dx: 0, dy: 0, desc: '初始位置 (0, 0)' },
                { id: 1, code: 'GR', param: '(1)', dx: 0, dy: 1, desc: '向右移動 1 格 (Y+1)' },
                { id: 2, code: 'GD', param: '(2)', dx: 2, dy: 0, desc: '向下移動 2 格 (X+2)' },
                { id: 3, code: 'GL', param: '(1)', dx: 0, dy: -1, desc: '向左移動 1 格 (Y-1)' },
                { id: 4, code: 'GD', param: '(1)', dx: 1, dy: 0, desc: '向下移動 1 格 (X+1)' },
                { id: 5, code: 'GR', param: '(2)', dx: 0, dy: 2, desc: '向右移動 2 格 (Y+2)' },
            ];

            const currentPos = path[path.length - 1];

            const handleNext = () => {
                if (step < instructions.length - 1) {
                    const nextInstruction = instructions[step + 1];
                    const newPos = {
                        x: currentPos.x + nextInstruction.dx,
                        y: currentPos.y + nextInstruction.dy
                    };
                    setPath([...path, newPos]);
                    setStep(step + 1);
                }
            };

            const handleReset = () => {
                setStep(0);
                setPath([{ x: 0, y: 0 }]);
            };

            // Helper: Check if a line segment exists between two points for drawing
            const hasLine = (x1, y1, x2, y2) => {
                for (let i = 0; i < path.length - 1; i++) {
                    const p1 = path[i];
                    const p2 = path[i+1];
                    
                    // Direct segment match
                    if (
                        (p1.x === x1 && p1.y === y1 && p2.x === x2 && p2.y === y2) ||
                        (p1.x === x2 && p1.y === y2 && p2.x === x1 && p2.y === y1)
                    ) {
                        return true;
                    }
                    
                    // Handle segments longer than 1 unit (e.g., GD(2))
                    if (p1.x === p2.x) { // Horizontal move
                        const minY = Math.min(p1.y, p2.y);
                        const maxY = Math.max(p1.y, p2.y);
                        // Check if the segment (x1,y1)-(x2,y2) is horizontal and within range
                        if (x1 === x2 && x1 === p1.x && y1 === y2 - 1 && y1 >= minY && y2 <= maxY) return true; 
                    }
                    if (p1.y === p2.y) { // Vertical move
                        const minX = Math.min(p1.x, p2.x);
                        const maxX = Math.max(p1.x, p2.x);
                        // Check if the segment (x1,y1)-(x2,y2) is vertical and within range
                        if (y1 === y2 && y1 === p1.y && x1 === x2 - 1 && x1 >= minX && x2 <= maxX) return true;
                    }
                }
                return false;
            };

            return (
                <div className="flex flex-col lg:flex-row gap-8 h-full">
                    {/* Left: Visualization Grid */}
                    <div className="flex-1 flex flex-col items-center">
                        <h3 className="text-xl font-bold mb-6 text-gray-800 self-start border-l-4 border-blue-600 pl-3">路徑模擬圖</h3>
                        
                        <div className="relative bg-white p-6 rounded-lg shadow-inner border border-gray-200">
                            {/* Grid Container */}
                            <div className="inline-block border-2 border-gray-800 bg-white shadow-lg">
                                {/* Header Row (Y axis) */}
                                <div className="flex border-b border-gray-300">
                                    <div className="w-14 h-14 flex items-center justify-center bg-gray-100 border-r border-gray-300 relative">
                                        <span className="absolute top-1 left-2 text-xs font-bold text-gray-500">Y</span>
                                        <span className="absolute bottom-1 right-2 text-xs font-bold text-gray-500">X</span>
                                        <div className="absolute w-full h-[1px] bg-gray-300 top-1/2 -translate-y-1/2 rotate-45 scale-125"></div>
                                    </div>
                                    {[0, 1, 2, 3, 4].map(y => (
                                        <div key={y} className="w-14 h-14 flex items-center justify-center border-r border-gray-200 font-bold text-gray-600 bg-gray-50">
                                            {y}
                                        </div>
                                    ))}
                                </div>

                                {/* Grid Rows (X axis) */}
                                {[0, 1, 2, 3, 4].map(x => (
                                    <div key={x} className="flex border-b border-gray-200">
                                        {/* Row Header */}
                                        <div className="w-14 h-14 flex items-center justify-center bg-gray-50 border-r border-gray-300 font-bold text-gray-600">
                                            {x}
                                        </div>
                                        
                                        {/* Cells */}
                                        {[0, 1, 2, 3, 4].map(y => {
                                            const isCurrentPos = currentPos.x === x && currentPos.y === y;
                                            const isStartPos = x === 0 && y === 0;
                                            
                                            // Check connections for drawing lines
                                            // Check right connection (x,y) to (x, y+1)
                                            const hasRight = hasLine(x, y, x, y + 1);
                                            // Check bottom connection (x,y) to (x+1, y)
                                            const hasBottom = hasLine(x, y, x + 1, y);
                                            
                                            return (
                                                <div key={`${x}-${y}`} className="w-14 h-14 border-r border-gray-100 relative flex items-center justify-center">
                                                    {/* Grid Lines (Visual Aid) */}
                                                    <div className="absolute inset-0 border-r border-b border-gray-50 pointer-events-none"></div>

                                                    {/* Path Lines - Absolute positioning to bridge cells */}
                                                    {hasRight && <div className="absolute right-0 top-1/2 w-8 h-1.5 bg-gray-800 translate-x-1/2 -translate-y-1/2 z-0"></div>}
                                                    {hasBottom && <div className="absolute bottom-0 left-1/2 h-8 w-1.5 bg-gray-800 translate-y-1/2 -translate-x-1/2 z-0"></div>}

                                                    {/* Points */}
                                                    {path.some(p => p.x === x && p.y === y) && (
                                                        <div className={`relative z-10 w-4 h-4 rounded-full transition-all duration-300 
                                                            ${isCurrentPos ? 'bg-blue-600 scale-125 ring-4 ring-blue-200' : 'bg-gray-800'}
                                                        `}>
                                                            {isStartPos && path.length > 1 && !isCurrentPos && (
                                                                <span className="absolute -top-6 -left-2 text-xs font-bold text-gray-500 bg-white px-1 rounded shadow-sm border border-gray-200">Start</span>
                                                            )}
                                                        </div>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>
                                ))}
                            </div>
                        </div>
                        
                        {/* Result Display */}
                        <div className="mt-6 w-full max-w-md">
                            {step === instructions.length - 1 ? (
                                <div className="p-4 bg-green-100 border border-green-300 rounded-lg flex items-center gap-4 animate-pulse">
                                    <div className="text-green-600"><CheckCircleIcon size={32} /></div>
                                    <div>
                                        <p className="font-bold text-green-800 text-lg">最終位置: ({currentPos.x}, {currentPos.y})</p>
                                        <p className="text-sm text-green-700">模擬完成</p>
                                    </div>
                                </div>
                            ) : (
                                <div className="p-4 bg-blue-50 border border-blue-200 rounded-lg text-center shadow-sm">
                                    <p className="text-blue-800 font-medium">當前位置: <span className="font-mono font-bold text-xl ml-2">({currentPos.x}, {currentPos.y})</span></p>
                                </div>
                            )}
                        </div>
                    </div>

                    {/* Right: Instruction List & Controls */}
                    <div className="w-full lg:w-80 flex flex-col">
                        <h3 className="text-xl font-bold mb-4 text-gray-800 border-l-4 border-blue-600 pl-3">指令列表</h3>
                        
                        <div className="flex-1 bg-white border border-gray-200 rounded-lg shadow-sm overflow-hidden flex flex-col h-[500px]">
                            <div className="overflow-y-auto flex-1 p-2 space-y-2">
                                {instructions.map((inst, index) => {
                                    const isActive = index === step;
                                    const isPast = index < step;
                                    
                                    return (
                                        <div 
                                            key={index}
                                            id={`inst-${index}`}
                                            className={`flex items-center p-3 rounded-lg border transition-all duration-300 ${
                                                isActive 
                                                    ? 'bg-blue-600 border-blue-600 text-white shadow-md transform scale-105 z-10' 
                                                    : isPast 
                                                        ? 'bg-gray-100 border-gray-200 text-gray-400' 
                                                        : 'bg-white border-gray-200 text-gray-600'
                                            }`}
                                        >
                                            <div className="w-8 font-mono text-sm opacity-60">#{index}</div>
                                            <div className="flex-1 font-mono font-bold text-lg">
                                                {inst.code}<span className="opacity-80 text-base">{inst.param}</span>
                                            </div>
                                            <div className="text-sm text-right">
                                                {isActive && <span className="flex items-center gap-1 font-bold"><ChevronRightIcon size={16}/> 執行中</span>}
                                                {isPast && <CheckCircleIcon size={16} />}
                                            </div>
                                        </div>
                                    );
                                })}
                            </div>
                            
                            {/* Instruction Detail Box */}
                            <div className="p-4 bg-gray-50 border-t border-gray-200">
                                <p className="text-xs text-gray-500 uppercase font-bold mb-1">當前指令說明</p>
                                <p className="text-gray-800 font-medium">
                                    {instructions[step].desc}
                                </p>
                            </div>
                        </div>

                        {/* Controls */}
                        <div className="mt-4 flex gap-3">
                            <button
                                onClick={handleNext}
                                disabled={step >= instructions.length - 1}
                                className="flex-1 bg-blue-600 hover:bg-blue-700 disabled:bg-gray-300 disabled:cursor-not-allowed text-white py-3 rounded-lg font-bold flex items-center justify-center gap-2 shadow-sm transition-all active:scale-95"
                            >
                                <PlayIcon size={20} fill="currentColor" /> 下一步
                            </button>
                            <button
                                onClick={handleReset}
                                className="px-4 bg-white border border-gray-300 hover:bg-gray-50 text-gray-700 py-3 rounded-lg font-bold flex items-center justify-center gap-2 shadow-sm transition-all active:scale-95"
                            >
                                <RotateCcwIcon size={20} /> 重置
                            </button>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Part B Component: Algorithm ---
        const PartBAlgorithm = () => {
            const [W, setW] = useState(3);
            const [L, setL] = useState(4);
            const [isRunning, setIsRunning] = useState(false);
            const [currentI, setCurrentI] = useState(-1);
            const [currentJ, setCurrentJ] = useState(-1);
            const [grid, setGrid] = useState([]);
            const [completed, setCompleted] = useState(false);
            const [speed, setSpeed] = useState(30);

            useEffect(() => {
                resetGrid();
            }, [W, L]);

            const resetGrid = () => {
                const rows = W + 2;
                const cols = L + 2;
                const newGrid = Array(rows).fill(null).map(() => Array(cols).fill(null));
                setGrid(newGrid);
                setCurrentI(-1);
                setCurrentJ(-1);
                setCompleted(false);
                setIsRunning(false);
            };

            useEffect(() => {
                if (!isRunning) return;
                const rows = W + 2;
                const cols = L + 2;

                const runStep = () => {
                    if (currentI === -1) {
                        setCurrentI(0);
                        setCurrentJ(0);
                        return;
                    }

                    const newGrid = [...grid];
                    // Logic from question
                    if (currentI === 0 || currentI === rows - 1 || currentJ === 0 || currentJ === cols - 1) {
                        newGrid[currentI][currentJ] = '#';
                    } else {
                        newGrid[currentI][currentJ] = '*';
                    }
                    setGrid(newGrid);

                    if (currentJ < cols - 1) {
                        setCurrentJ(prev => prev + 1);
                    } else {
                        if (currentI < rows - 1) {
                            setCurrentI(prev => prev + 1);
                            setCurrentJ(0);
                        } else {
                            setIsRunning(false);
                            setCompleted(true);
                        }
                    }
                };

                const timer = setTimeout(runStep, speed);
                return () => clearTimeout(timer);
            }, [isRunning, currentI, currentJ, W, L, grid, speed]);

            return (
                <div className="flex flex-col gap-6">
                    <div className="grid grid-cols-1 md:grid-cols-2 gap-8">
                        {/* Pseudocode Panel */}
                        <div className="bg-gray-900 text-gray-100 p-6 rounded-lg font-mono text-sm shadow-xl relative overflow-hidden">
                            <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-blue-500 to-purple-500"></div>
                            <h4 className="text-gray-400 mb-4 border-b border-gray-700 pb-2 flex justify-between">
                                <span>偽代碼 (Pseudocode)</span>
                                <span className="text-xs bg-gray-700 px-2 py-0.5 rounded text-gray-300">Read-only</span>
                            </h4>
                            
                            <div className="space-y-3">
                                <div className="text-purple-300 font-bold">GeneratePreview(W, L)</div>
                                <div className={`pl-4 p-1 rounded transition-colors ${currentI !== -1 && !completed ? 'bg-gray-800 border-l-2 border-blue-500' : 'border-l-2 border-transparent'}`}>
                                    <span className="text-blue-300">設</span> i <span className="text-blue-300">由</span> 0 <span className="text-blue-300">至</span> 
                                    <span className="text-yellow-400 font-bold mx-1">W + 1</span> 
                                    <span className="text-green-500 text-xs">// (b1)</span>
                                    <span className="text-blue-300 ml-1">執行</span>
                                </div>
                                
                                <div className={`pl-8 p-1 rounded transition-colors ${currentJ !== -1 && !completed ? 'bg-gray-800 border-l-2 border-blue-500' : 'border-l-2 border-transparent'}`}>
                                    <span className="text-blue-300">設</span> j <span className="text-blue-300">由</span> 0 <span className="text-blue-300">至</span> 
                                    <span className="text-yellow-400 font-bold mx-1">L + 1</span>
                                    <span className="text-green-500 text-xs">// (b2)</span>
                                    <span className="text-blue-300 ml-1">執行</span>
                                </div>

                                <div className="pl-12 mt-2">
                                    <div className={`p-2 rounded border border-dashed transition-colors duration-200 ${currentI !== -1 && !completed ? 'border-gray-600 bg-gray-800' : 'border-gray-800'}`}>
                                        <div className="text-gray-500 text-xs mb-1">// (b3) 邊界判斷邏輯</div>
                                        <div className={currentI !== -1 && !completed && (currentI === 0 || currentI === W+1 || currentJ === 0 || currentJ === L+1) ? 'text-yellow-300 font-bold' : 'text-gray-500'}>
                                            如果 (i == 0 OR i == W+1 OR j == 0 OR j == L+1) 則
                                        </div>
                                        <div className="pl-4 text-white">
                                            Grid[i, j] = <span className="text-red-400">'#'</span>
                                        </div>
                                        <div className={currentI !== -1 && !completed && !(currentI === 0 || currentI === W+1 || currentJ === 0 || currentJ === L+1) ? 'text-yellow-300 font-bold' : 'text-gray-500'}>
                                            否則
                                        </div>
                                        <div className="pl-4 text-white">
                                            Grid[i, j] = <span className="text-green-400">'*'</span>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        {/* Grid Preview Panel */}
                        <div>
                            <div className="flex justify-between items-center mb-4">
                                <h3 className="text-xl font-bold text-gray-800 border-l-4 border-blue-600 pl-3">預覽網格</h3>
                                <div className="flex gap-3 text-xs font-medium">
                                    <div className="flex items-center gap-1 bg-red-50 px-2 py-1 rounded border border-red-100">
                                        <span className="text-red-600 font-bold">#</span> 切割
                                    </div>
                                    <div className="flex items-center gap-1 bg-green-50 px-2 py-1 rounded border border-green-100">
                                        <span className="text-green-600 font-bold">*</span> 刻印
                                    </div>
                                </div>
                            </div>

                            <div className="overflow-auto border border-gray-300 rounded-lg shadow-sm bg-white p-4 max-h-[400px] flex justify-center">
                                <table className="border-collapse">
                                    <thead>
                                        <tr>
                                            <th className="w-8 h-8 bg-gray-100 border border-gray-300 text-[10px] text-gray-500 relative">
                                                <span className="absolute top-0 left-1">Y</span>
                                                <span className="absolute bottom-0 right-1">X</span>
                                            </th>
                                            {Array(L + 2).fill(0).map((_, idx) => (
                                                <th key={idx} className="w-8 h-8 bg-gray-50 border border-gray-300 text-xs text-gray-600">{idx}</th>
                                            ))}
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {grid.map((row, rIdx) => (
                                            <tr key={rIdx}>
                                                <th className="w-8 h-8 bg-gray-50 border border-gray-300 text-xs text-gray-600">{rIdx}</th>
                                                {row.map((cell, cIdx) => {
                                                    const isActive = rIdx === currentI && cIdx === currentJ;
                                                    let cellClass = "w-8 h-8 border border-gray-200 text-center font-mono font-bold transition-all duration-150 ";
                                                    if (isActive) cellClass += "bg-blue-600 text-white scale-110 shadow-lg z-10 rounded-sm ";
                                                    else if (cell === '#') cellClass += "bg-red-50 text-red-600 ";
                                                    else if (cell === '*') cellClass += "bg-green-50 text-green-600 ";
                                                    else cellClass += "bg-white ";

                                                    return (
                                                        <td key={`${rIdx}-${cIdx}`} className={cellClass}>
                                                            {cell}
                                                        </td>
                                                    );
                                                })}
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>

                            <div className="mt-6 space-y-4">
                                <div className="flex gap-4 items-center bg-gray-100 p-4 rounded-lg border border-gray-200">
                                    <div className="flex flex-col">
                                        <label className="text-xs font-bold text-gray-500 uppercase">W (Height)</label>
                                        <input 
                                            type="number" min="1" max="8" value={W} 
                                            onChange={(e) => { setW(parseInt(e.target.value) || 1); setIsRunning(false); }}
                                            className="w-20 p-2 border rounded font-bold text-center"
                                            disabled={isRunning}
                                        />
                                    </div>
                                    <div className="flex flex-col">
                                        <label className="text-xs font-bold text-gray-500 uppercase">L (Width)</label>
                                        <input 
                                            type="number" min="1" max="8" value={L} 
                                            onChange={(e) => { setL(parseInt(e.target.value) || 1); setIsRunning(false); }}
                                            className="w-20 p-2 border rounded font-bold text-center"
                                            disabled={isRunning}
                                        />
                                    </div>
                                    <div className="flex-1 text-right">
                                        <div className="text-xs text-gray-500">Grid Size</div>
                                        <div className="font-bold text-gray-800">{W+2} x {L+2}</div>
                                    </div>
                                </div>

                                <div className="flex gap-3">
                                    {!isRunning && !completed ? (
                                        <button 
                                            onClick={() => setIsRunning(true)}
                                            className="flex-1 bg-blue-600 hover:bg-blue-700 text-white py-3 rounded-lg font-bold flex items-center justify-center gap-2 shadow-md transition-all active:scale-95"
                                        >
                                            <PlayIcon size={18} fill="currentColor" /> 開始執行
                                        </button>
                                    ) : (
                                        <button 
                                            onClick={resetGrid}
                                            className="flex-1 bg-gray-600 hover:bg-gray-700 text-white py-3 rounded-lg font-bold flex items-center justify-center gap-2 shadow-md transition-all active:scale-95"
                                        >
                                            <RotateCcwIcon size={18} /> 重置 / 重新開始
                                        </button>
                                    )}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main App Component ---
        const ExamExplanation = () => {
            const [activeTab, setActiveTab] = useState('partA');

            return (
                <div className="w-full max-w-5xl mx-auto p-4 md:p-8">
                    <div className="bg-white rounded-xl shadow-xl overflow-hidden min-h-[700px] flex flex-col">
                        <div className="flex border-b border-gray-200 bg-gray-50">
                            <button
                                onClick={() => setActiveTab('partA')}
                                className={`flex-1 md:flex-none px-8 py-4 font-bold text-lg transition-colors border-b-4 ${
                                    activeTab === 'partA'
                                        ? 'text-blue-600 border-blue-600 bg-white'
                                        : 'text-gray-500 border-transparent hover:text-gray-700 hover:bg-gray-100'
                                }`}
                            >
                                (a) 移動模擬
                            </button>
                            <button
                                onClick={() => setActiveTab('partB')}
                                className={`flex-1 md:flex-none px-8 py-4 font-bold text-lg transition-colors border-b-4 ${
                                    activeTab === 'partB'
                                        ? 'text-blue-600 border-blue-600 bg-white'
                                        : 'text-gray-500 border-transparent hover:text-gray-700 hover:bg-gray-100'
                                }`}
                            >
                                (b) 偽代碼填空
                            </button>
                        </div>

                        <div className="p-6 md:p-8 flex-1 bg-white">
                            {activeTab === 'partA' ? <PartASimulation /> : <PartBAlgorithm />}
                        </div>
                    </div>
                    <div className="text-center mt-4 text-gray-400 text-sm">
                        ICT Exam Simulation Tool
                    </div>
                </div>
            );
        };

        // Render the app
        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<ExamExplanation />);
    </script>
</body>
</html>